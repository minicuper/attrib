index(bem='Input' attributes='label description')
  //- Workaround the inherit bug (feature?) with custom created attributes
  //- not visible in main template
  if @meta
    with @meta.properties as #properties
      with @meta.order as #tOrder
        with @meta.order === undefined ? Object.keys( @meta.properties || {} ) : @meta.order as #order
          view(is='{{ _layout }}' inherit)
  else
    with @properties as #properties
      with @order as #order
        with @order === undefined ? Object.keys( @properties || {} ) : @order as #order
          view(is='{{ _layout }}' inherit)

pure:(bem='InputObject')
  .&(class='{{if @class}}{{@class}}{{/}}')
    each #order as #inputName
      with #properties[#inputName] as #input
        if resolvesDeps(value, #input.dependsOn, #input.dependsValue)
          //- Hack to run clear() only if it was changed
          //- and not run it initially
          | {{ setVisibleFlag( #inputName ) }}
          view(is='dm-form:{{ #input.input }}' meta='{{ #input }}'
              object='{{ value }}' _name='{{ #inputName }}')
        else
          //- When the dependsOn field changes and this field
          //- is no longer visible -- clear it.
          | {{ clear($at(value), #inputName) }}

columns:(bem='Input')
  view(is='pure' inherit)
