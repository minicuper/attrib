module.exports = class FormText extends require('../input')
  view: __dirname
  style: __dirname
  name: 'dm-form:text'

  _getExtraFields: -> [
    'lazy'
  ]

  init: ->
    super
    layout = @model.get '_layout'
    @model.set('uniqId', @model.id()) if layout is 'columns'
    @setAttribute 'lazy', true if @model.get('name') is '$id'
    @_initLazy()

  _initLazy: ->
    if @getMetaAttribute('lazy')
      @model.set '_value', @model.get('value')
      @model.on 'change', 'value', (value, prev, {skip}) =>
        return if value is prev
        return if skip
        @model.setDiff '_value', value
    else
      @model.ref '_value', 'value'

  lazySet: ->
    return unless @getMetaAttribute('lazy')
    @model.pass(skip: true).setDiff 'value', @model.get('_value')
