index(bem='Input' attributes='items')
  if @meta
    with @meta.items as #items
      with @meta.labels as #labels
        on rerender
          view(is='{{ _layout }}' inherit)
  else
    with @items as #items
      with @labels as #labels
        on rerender
          view(is='{{ _layout }}' inherit)

pure:(bem='InputArray')
  .&(class='{{if @class}}{{@class}}{{/}}')
    if @controls
      view(is='controls')
    each value as #item, #index
      if @collapsable
        .&-item.-collapsed
          .&-itemControls
            if @controls
              input.&-check(type='checkbox' checked='{{ checked[#index] }}')
            .&-index
              select
                each indexes as #i
                  option(selected='{{ changeOrder(#index, #i) }}') {{ #i + 1 }}
          a.&-itemInner(on-click='toggle(#index)')
            .&-name
              span {{ getName(#item) }}
            .&-type
              span {{ getType(#item) }}
            if getDescription(#item) as #description
              .&-description
                span {{ #description }}
          .&-itemControls
            a.&-addPlus(on-click='add(#index)'
                title='Add new into this position')
            if @duplicate
              a.&-duplicate(on-click='duplicate($at(#item))'
                  title='Duplicate')
            a.&-buttonDelete(on-click='remove($at(#item))' tabindex='-1')
      if !@collapsable || expand[#index]
        .&-item
          view(name='dm-form:{{ #items.input }}' meta='{{ #items }}'
              value='{{ #item }}')
          unless @collapsable
            a.&-delete(on-click='remove($at(#item))' tabindex='-1') âœ•
            a.&-addPlus.-implicit(on-click='add(#index)')
    a.&-addPlus.-block(on-click='add()')
    //button.btn.&-add(on-click='add()') {{#labels.add || 'Add item'}}

columns:(bem='Input')
  view(is='pure' inherit)

controls:(bem='InputArray')
  with hasChecked(checked) as #hasChecked
    .&-controls
      view(is='clipboard')
      unless allChecked(checked, value.length)
        button.btn(on-click='checkAll()') Select all
      if #hasChecked
        button.btn(on-click='uncheckAll()') De-select all
        button.btn(on-click='export()') Export to file
      button.btn.&-importBtn(on-click='import(importIndex)') Import from file at
      select
        option(selected='{{ importIndex === undefined }}') End
        each indexes as #i
          option(selected='{{ importIndex === #i }}') {{ #i + 1 }}
      if #hasChecked
        button.btn.-error(on-click='removeSelected()') Delete selected items

clipboard:(bem='InputArray')
  with #hasChecked || clipboard as #activeClipboard
    .&-clipboard(class="{{ #activeClipboard && '-active' }}")
      unless #activeClipboard
        .&-clipboardInfo Select items you want to copy
      if #hasChecked
        button.btn(on-click='copyToClipboard()') Copy selected items
      if clipboard
        button.btn.&-importBtn(on-click='pasteFromClipboard(pasteIndex)') Paste at
        select
          option(selected='{{ pasteIndex === undefined }}') End
          each indexes as #i
            option(selected='{{ pasteIndex === #i }}') {{ #i + 1 }}
        button.btn(on-click='clearClipboard()') Clear clipboard
        .&-clipboardPreview
          each clipboard as #item
            .&-clipboardPreviewItem {{ #item.name }}