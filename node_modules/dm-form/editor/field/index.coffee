#########################################################
# Field
#########################################################

_ = require 'lodash'
async = require 'async'

module.exports = class Field
  view: require './index.jade'
  style: require './index.styl'

  init: ->
    
    @model.start 'indexes', 'valueIds', (arr) ->
      if _.isArray(arr)
        [0...arr.length]
      else
        []
        
  create: ->
    
  expand: ->
    @model.set 'expand', true

  collapse: ->
    @model.del 'expand'

  toggle: ->
    if @model.get('expand')
      @collapse()
    else
      @expand()

  getType: (item) ->
    item?.input || item?.type

  getDescription: (item) ->
    item?.description || item?.fullname

  changeOrder:
    get: (value, option) ->
      option is value
    set: (optionSelected, value, option) ->
      return unless optionSelected
      console.log 'Move FROM', value, 'TO', option
      @model.move 'valueIds', value, option
      @_rerender()
      undefined

  cancelEditing: (e)->
    @model.del 'editing'
    e.stopPropagation()

  saveEditing: (e)->
    oldName = @model.get('itemId')
    name = (@model.get('name') || '').trim()
    return unless name
    return if name is oldName

    @emit 'editName', oldName, name
    @cancelEditing(e)

  startEditing: (e)->
    @model.set 'name', @model.get 'itemId'
    @model.set 'editing', true
    e.stopPropagation()

  clickOnNameInput: (e) ->
    e.stopPropagation()

  checkIfNameIsCorrect: (oldName, newName = '') ->
    name = newName.trim()
    return false unless name
    return true if oldName is name

    valueIds = @model.get('valueIds')
    return false if valueIds.indexOf(name) isnt -1

    return true



